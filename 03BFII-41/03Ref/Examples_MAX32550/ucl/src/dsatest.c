/* ----------------------------------------------------------------------------
 * Copyright (c) 2013, Maxim Integrated
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the Maxim Integrated nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY MAXIM INTEGRATED ''AS IS'' AND ANY
 * EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL MAXIM INTEGRATED BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

/** Global includes */
#include <ucl_testing_config.h>
#ifdef DSA
#ifndef SYSTEM_MINGW
#include <errors.h>
#endif//MINGW
/** Other includes */
#ifdef SYSTEM_JIBE
#include <printf_lite.h>
#include <jibe_gcr.h>
#include <jibe_uart.h>
#endif
#ifdef SYSTEM_LIGHTHOUSE
#include <printf_lite.h>
#endif
#include <string.h>
#include <ucl/ucl_config.h>
#include <ucl/ucl_defs.h>
#include <ucl/ucl_retdefs.h>
#include <ucl/ucl_types.h>
#include <ucl/ucl_sys.h>
#include <ucl/ucl_rng.h>
#include <ucl/ucl_dsa.h>
#include <ucl/ucl_info.h>
#include <ucl/ucl_sha256.h>
#include <ucl/ucl_sha224.h>
#include <ucl/ucl_sha384.h>
#include <ucl/ucl_sha512.h>
#include <ucl/ucl_sha1.h>
/** Local includes */
#ifdef SYSTEM_JIBE
#include <uart_config.h>
#include <printf_lite.h>
#include <private.h>
#endif

int dsatest_verify(void)
{
  static const  u8 q1024_nist[]={0xE9,0x50,0x51,0x1E,0xAB,0x42,0x4B,0x9A,0x19,0xA2,0xAE,0xB4,0xE1,0x59,0xB7,0x84,0x4C,0x58,0x9C,0x4F};
  static const  u8 p1024_nist[]={0xE0,0xA6,0x75,0x98,0xCD,0x1B,0x76,0x3B,0xC9,0x8C,0x8A,0xBB,0x33,0x3E,0x5D,0xDA,0x0C,0xD3,0xAA,0x0E,0x5E,0x1F,0xB5,0xBA,0x8A,0x7B,0x4E,0xAB,0xC1,0x0B,0xA3,0x38,0xFA,0xE0,0x6D,0xD4,0xB9,0x0F,0xDA,0x70,0xD7,0xCF,0x0C,0xB0,0xC6,0x38,0xBE,0x33,0x41,0xBE,0xC0,0xAF,0x8A,0x73,0x30,0xA3,0x30,0x7D,0xED,0x22,0x99,0xA0,0xEE,0x60,0x6D,0xF0,0x35,0x17,0x7A,0x23,0x9C,0x34,0xA9,0x12,0xC2,0x02,0xAA,0x5F,0x83,0xB9,0xC4,0xA7,0xCF,0x02,0x35,0xB5,0x31,0x6B,0xFC,0x6E,0xFB,0x9A,0x24,0x84,0x11,0x25,0x8B,0x30,0xB8,0x39,0xAF,0x17,0x24,0x40,0xF3,0x25,0x63,0x05,0x6C,0xB6,0x7A,0x86,0x11,0x58,0xDD,0xD9,0x0E,0x6A,0x89,0x4C,0x72,0xA5,0xBB,0xEF,0x9E,0x28,0x6C,0x6B};
  //  static const u8 x1024_nist[]={0xD0,0xEC,0x4E,0x50,0xBB,0x29,0x0A,0x42,0xE9,0xE3,0x55,0xC7,0x3D,0x88,0x09,0x34,0x5D,0xE2,0xE1,0x39};
  static const u8 y1024_nist[]={0x25,0x28,0x22,0x17,0xF5,0x73,0x05,0x01,0xDD,0x8D,0xBA,0x3E,0xDF,0xCF,0x34,0x9A,0xAF,0xFE,0xC2,0x09,0x21,0x12,0x8D,0x70,0xFA,0xC4,0x41,0x10,0x33,0x22,0x01,0xBB,0xA3,0xF1,0x09,0x86,0x14,0x0C,0xBB,0x97,0xC7,0x26,0x93,0x80,0x60,0x47,0x3C,0x8E,0xC9,0x7B,0x47,0x31,0xDB,0x00,0x42,0x93,0xB5,0xE7,0x30,0x36,0x36,0x09,0xDF,0x97,0x80,0xF8,0xD8,0x83,0xD8,0xC4,0xD4,0x1D,0xED,0x6A,0x2F,0x1E,0x1B,0xBB,0xDC,0x97,0x9E,0x1B,0x9D,0x6D,0x3C,0x94,0x03,0x01,0xF4,0xE9,0x78,0xD6,0x5B,0x19,0x04,0x1F,0xCF,0x1E,0x8B,0x51,0x8F,0x5C,0x05,0x76,0xC7,0x70,0xFE,0x5A,0x7A,0x48,0x5D,0x83,0x29,0xEE,0x29,0x14,0xA2,0xDE,0x1B,0x5D,0xA4,0xA6,0x12,0x8C,0xEA,0xB7,0x0F,0x79};
  static const  u8 g1024_nist[]={0xD2,0x9D,0x51,0x21,0xB0,0x42,0x3C,0x27,0x69,0xAB,0x21,0x84,0x3E,0x5A,0x32,0x40,0xFF,0x19,0xCA,0xCC,0x79,0x22,0x64,0xE3,0xBB,0x6B,0xE4,0xF7,0x8E,0xDD,0x1B,0x15,0xC4,0xDF,0xF7,0xF1,0xD9,0x05,0x43,0x1F,0x0A,0xB1,0x67,0x90,0xE1,0xF7,0x73,0xB5,0xCE,0x01,0xC8,0x04,0xE5,0x09,0x06,0x6A,0x99,0x19,0xF5,0x19,0x5F,0x4A,0xBC,0x58,0x18,0x9F,0xD9,0xFF,0x98,0x73,0x89,0xCB,0x5B,0xED,0xF2,0x1B,0x4D,0xAB,0x4F,0x8B,0x76,0xA0,0x55,0xFF,0xE2,0x77,0x09,0x88,0xFE,0x2E,0xC2,0xDE,0x11,0xAD,0x92,0x21,0x9F,0x0B,0x35,0x18,0x69,0xAC,0x24,0xDA,0x3D,0x7B,0xA8,0x70,0x11,0xA7,0x01,0xCE,0x8E,0xE7,0xBF,0xE4,0x94,0x86,0xED,0x45,0x27,0xB7,0x18,0x6C,0xA4,0x61,0x0A,0x75};
  u8 r1024_nist[]={0x63,0x61,0x55,0xac,0x9a,0x46,0x33,0xb4,0x66,0x5d,0x17,0x9f,0x9e,0x41,0x17,0xdf,0x68,0x60,0x1f,0x34};
  u8 s1024_nist[]={0x6c,0x54,0x0b,0x02,0xd9,0xd4,0x85,0x2f,0x89,0xdf,0x8c,0xfc,0x99,0x96,0x32,0x04,0xf4,0x34,0x77,0x04};
  u8 msg1024_nist[]={'a','b','c'};
  
  static const u8 p2048_nist[] = {0xa8,0xad,0xb6,0xc0,0xb4,0xcf,0x95,0x88,0x01,0x2e,0x5d,0xef,0xf1,0xa8,0x71,0xd3,0x83,0xe0,0xe2,0xa8,0x5b,0x5e,0x8e,0x03,0xd8,0x14,0xfe,0x13,0xa0,0x59,0x70,0x5e,0x66,0x32,0x30,0xa3,0x77,0xbf,0x73,0x23,0xa8,0xfa,0x11,0x71,0x00,0x20,0x0b,0xfd,0x5a,0xdf,0x85,0x73,0x93,0xb0,0xbb,0xd6,0x79,0x06,0xc0,0x81,0xe5,0x85,0x41,0x0e,0x38,0x48,0x0e,0xad,0x51,0x68,0x4d,0xac,0x3a,0x38,0xf7,0xb6,0x4c,0x9e,0xb1,0x09,0xf1,0x97,0x39,0xa4,0x51,0x7c,0xd7,0xd5,0xd6,0x29,0x1e,0x8a,0xf2,0x0a,0x3f,0xbf,0x17,0x33,0x6c,0x7b,0xf8,0x0e,0xe7,0x18,0xee,0x08,0x7e,0x32,0x2e,0xe4,0x10,0x47,0xda,0xbe,0xfb,0xcc,0x34,0xd1,0x0b,0x66,0xb6,0x44,0xdd,0xb3,0x16,0x0a,0x28,0xc0,0x63,0x95,0x63,0xd7,0x19,0x93,0xa2,0x65,0x43,0xea,0xdb,0x77,0x18,0xf3,0x17,0xbf,0x5d,0x95,0x77,0xa6,0x15,0x65,0x61,0xb0,0x82,0xa1,0x00,0x29,0xcd,0x44,0x01,0x2b,0x18,0xde,0x68,0x44,0x50,0x9f,0xe0,0x58,0xba,0x87,0x98,0x07,0x92,0x28,0x5f,0x27,0x50,0x96,0x9f,0xe8,0x9c,0x2c,0xd6,0x49,0x8d,0xb3,0x54,0x56,0x38,0xd5,0x37,0x9d,0x12,0x5d,0xcc,0xf6,0x4e,0x06,0xc1,0xaf,0x33,0xa6,0x19,0x08,0x41,0xd2,0x23,0xda,0x15,0x13,0x33,0x3a,0x7c,0x9d,0x78,0x46,0x2a,0xba,0xab,0x31,0xb9,0xf9,0x6d,0x5f,0x34,0x44,0x5c,0xeb,0x63,0x09,0xf2,0xf6,0xd2,0xc8,0xdd,0xe0,0x64,0x41,0xe8,0x79,0x80,0xd3,0x03,0xef,0x9a,0x1f,0xf0,0x07,0xe8,0xbe,0x2f,0x0b,0xe0,0x6c,0xc1,0x5f};
  static const u8 q2048_nist[] = {0xe7,0x1f,0x85,0x67,0x44,0x7f,0x42,0xe7,0x5f,0x5e,0xf8,0x5c,0xa2,0x0f,0xe5,0x57,0xab,0x03,0x43,0xd3,0x7e,0xd0,0x9e,0xdc,0x3f,0x6e,0x68,0x60,0x4d,0x6b,0x9d,0xfb};
  static const u8 g2048_nist[] = {0x5b,0xa2,0x4d,0xe9,0x60,0x7b,0x89,0x98,0xe6,0x6c,0xe6,0xc4,0xf8,0x12,0xa3,0x14,0xc6,0x93,0x58,0x42,0xf7,0xab,0x54,0xcd,0x82,0xb1,0x9f,0xa1,0x04,0xab,0xfb,0x5d,0x84,0x57,0x9a,0x62,0x3b,0x25,0x74,0xb3,0x7d,0x22,0xcc,0xae,0x9b,0x3e,0x41,0x5e,0x48,0xf5,0xc0,0xf9,0xbc,0xbd,0xff,0x80,0x71,0xd6,0x3b,0x9b,0xb9,0x56,0xe5,0x47,0xaf,0x3a,0x8d,0xf9,0x9e,0x5d,0x30,0x61,0x97,0x96,0x52,0xff,0x96,0xb7,0x65,0xcb,0x3e,0xe4,0x93,0x64,0x35,0x44,0xc7,0x5d,0xbe,0x5b,0xb3,0x98,0x34,0x53,0x19,0x52,0xa0,0xfb,0x4b,0x03,0x78,0xb3,0xfc,0xbb,0x4c,0x8b,0x58,0x00,0xa5,0x33,0x03,0x92,0xa2,0xa0,0x4e,0x70,0x0b,0xb6,0xed,0x7e,0x0b,0x85,0x79,0x5e,0xa3,0x8b,0x1b,0x96,0x27,0x41,0xb3,0xf3,0x3b,0x9d,0xde,0x2f,0x4e,0xc1,0x35,0x4f,0x09,0xe2,0xeb,0x78,0xe9,0x5f,0x03,0x7a,0x58,0x04,0xb6,0x17,0x16,0x59,0xf8,0x87,0x15,0xce,0x1a,0x9b,0x0c,0xc9,0x0c,0x27,0xf3,0x5e,0xf2,0xf1,0x0f,0xf0,0xc7,0xc7,0xa2,0xbb,0x01,0x54,0xd9,0xb8,0xeb,0xe7,0x6a,0x3d,0x76,0x4a,0xa8,0x79,0xaf,0x37,0x2f,0x42,0x40,0xde,0x83,0x47,0x93,0x7e,0x5a,0x90,0xce,0xc9,0xf4,0x1f,0xf2,0xf2,0x6b,0x8d,0xa9,0xa9,0x4a,0x22,0x5d,0x1a,0x91,0x37,0x17,0xd7,0x3f,0x10,0x39,0x7d,0x21,0x83,0xf1,0xba,0x3b,0x7b,0x45,0xa6,0x8f,0x1f,0xf1,0x89,0x3c,0xaf,0x69,0xa8,0x27,0x80,0x2f,0x7b,0x6a,0x48,0xd5,0x1d,0xa6,0xfb,0xef,0xb6,0x4f,0xd9,0xa6,0xc5,0xb7,0x5c,0x45,0x61};

  static const u8 msg2048_nist[] = {0x4e,0x3a,0x28,0xbc,0xf9,0x0d,0x1d,0x2e,0x75,0xf0,0x75,0xd9,0xfb,0xe5,0x5b,0x36,0xc5,0x52,0x9b,0x17,0xbc,0x3a,0x9c,0xca,0xba,0x69,0x35,0xc9,0xe2,0x05,0x48,0x25,0x5b,0x3d,0xfa,0xe0,0xf9,0x1d,0xb0,0x30,0xc1,0x2f,0x2c,0x34,0x4b,0x3a,0x29,0xc4,0x15,0x1c,0x5b,0x20,0x9f,0x5e,0x31,0x9f,0xdf,0x1c,0x23,0xb1,0x90,0xf6,0x4f,0x1f,0xe5,0xb3,0x30,0xcb,0x7c,0x8f,0xa9,0x52,0xf9,0xd9,0x0f,0x13,0xaf,0xf1,0xcb,0x11,0xd6,0x31,0x81,0xda,0x9e,0xfc,0x6f,0x7e,0x15,0xbf,0xed,0x48,0x62,0xd1,0xa6,0x2c,0x7d,0xcf,0x3b,0xa8,0xbf,0x1f,0xf3,0x04,0xb1,0x02,0xb1,0xec,0x3f,0x14,0x97,0xdd,0xdf,0x09,0x71,0x2c,0xf3,0x23,0xf5,0x61,0x0a,0x9d,0x10,0xc3,0xd9,0x13,0x26,0x59};
  //  static const u8 x2048_nist[] = {0x44,0x69,0x69,0x02,0x54,0x46,0x24,0x7f,0x84,0xfd,0xea,0x74,0xd0,0x2d,0x7d,0xd1,0x36,0x72,0xb2,0xde,0xb7,0xc0,0x85,0xbe,0x11,0x11,0x14,0x41,0x95,0x5a,0x37,0x7b};
  static const u8 y2048_nist[] = {0x5a,0x55,0xdc,0xed,0xdd,0x11,0x34,0xee,0x5f,0x11,0xed,0x85,0xde,0xb4,0xd6,0x34,0xa3,0x64,0x3f,0x5f,0x36,0xdc,0x3a,0x70,0x68,0x92,0x56,0x46,0x9a,0x0b,0x65,0x1a,0xd2,0x28,0x80,0xf1,0x4a,0xb8,0x57,0x19,0x43,0x4f,0x9c,0x0e,0x40,0x7e,0x60,0xea,0x42,0x0e,0x2a,0x0c,0xd2,0x94,0x22,0xc4,0x89,0x9c,0x41,0x63,0x59,0xdb,0xb1,0xe5,0x92,0x45,0x6f,0x2b,0x3c,0xce,0x23,0x32,0x59,0xc1,0x17,0x54,0x2f,0xd0,0x5f,0x31,0xea,0x25,0xb0,0x15,0xd9,0x12,0x1c,0x89,0x0b,0x90,0xe0,0xba,0xd0,0x33,0xbe,0x13,0x68,0xd2,0x29,0x98,0x5a,0xac,0x72,0x26,0xd1,0xc8,0xc2,0xea,0xb3,0x25,0xef,0x3b,0x2c,0xd5,0x9d,0x3b,0x9f,0x7d,0xe7,0xdb,0xc9,0x4a,0xf1,0xa9,0x33,0x9e,0xb4,0x30,0xca,0x36,0xc2,0x6c,0x46,0xec,0xfa,0x6c,0x54,0x81,0x71,0x14,0x96,0xf6,0x24,0xe1,0x88,0xad,0x75,0x40,0xef,0x5d,0xf2,0x6f,0x8e,0xfa,0xcb,0x82,0x0b,0xd1,0x7a,0x1f,0x61,0x8a,0xcb,0x50,0xc9,0xbc,0x19,0x7d,0x4c,0xb7,0xcc,0xac,0x45,0xd8,0x24,0xa3,0xbf,0x79,0x5c,0x23,0x4b,0x55,0x6b,0x06,0xae,0xb9,0x29,0x17,0x34,0x53,0x25,0x20,0x84,0x00,0x3f,0x69,0xfe,0x98,0x04,0x5f,0xe7,0x40,0x02,0xba,0x65,0x8f,0x93,0x47,0x56,0x22,0xf7,0x67,0x91,0xd9,0xb2,0x62,0x3d,0x1b,0x5f,0xff,0x2c,0xc1,0x68,0x44,0x74,0x6e,0xfd,0x2d,0x30,0xa6,0xa8,0x13,0x4b,0xfc,0x4c,0x8c,0xc8,0x0a,0x46,0x10,0x79,0x01,0xfb,0x97,0x3c,0x28,0xfc,0x55,0x31,0x30,0xf3,0x28,0x6c,0x14,0x89,0xda};
  //K = 117a529e3fdfc79843a5a4c07539036b865214e014b4928c2a31f47bf62a4fdb
  static const u8 r2048_nist[] = {0x63,0x30,0x55,0xe0,0x55,0xf2,0x37,0xc3,0x89,0x99,0xd8,0x1c,0x39,0x78,0x48,0xc3,0x8c,0xce,0x80,0xa5,0x5b,0x64,0x9d,0x9e,0x79,0x05,0xc2,0x98,0xe2,0xa5,0x14,0x47};
  static const u8 s2048_nist[] = {0x2b,0xbf,0x68,0x31,0x76,0x60,0xec,0x1e,0x4b,0x15,0x49,0x15,0x02,0x7b,0x0b,0xc0,0x0e,0xe1,0x9c,0xfc,0x0b,0xf7,0x5d,0x01,0x93,0x05,0x04,0xf2,0xce,0x10,0xa8,0xb0};

  u8 msg[128];
  u8 r[UCL_SHA256_HASHSIZE];
  u8 s[UCL_SHA256_HASHSIZE];
  u8 x[UCL_SHA256_HASHSIZE];
  u8 r_and_others[UCL_SHA256_HASHSIZE*2];
  //2048b
  u8 y[256];
  int i;
  int err;
  int loop;
  int msg_len;
  u32 configuration;
#ifdef VERBOSE
  PRINTF("KAT NIST\n");
#endif
  configuration=(UCL_MSG_INPUT<<UCL_INPUT_SHIFT)^(UCL_NO_PRECOMP<<UCL_PRECOMP_SHIFT)^(UCL_SHA1<<UCL_HASH_SHIFT);
  err=ucl_dsa_verify((u8*)r1024_nist,(u8*)s1024_nist,(u8*)p1024_nist,128,(u8*)q1024_nist,(u8*)g1024_nist,(u8*)y1024_nist,(u8*)msg1024_nist,3,configuration);
  if(UCL_OK!=err)
    {
      PRINTF("verify 1024 error=%d\n",err);
      return(UCL_ERROR);
    }
#ifdef VERBOSE
  PRINTF("1024 ok\n");
#endif
  configuration=(UCL_MSG_INPUT<<UCL_INPUT_SHIFT)^(UCL_NO_PRECOMP<<UCL_PRECOMP_SHIFT)^(UCL_SHA256<<UCL_HASH_SHIFT);
  err=ucl_dsa_verify((u8*)r2048_nist,(u8*)s2048_nist,(u8*)p2048_nist,256,(u8*)q2048_nist,(u8*)g2048_nist,(u8*)y2048_nist,(u8*)msg2048_nist,128,configuration);
  if(UCL_OK!=err)
    {
      PRINTF("verify 2048 error=%d\n",err);
      return(UCL_ERROR);
    }
#ifdef VERBOSE
  PRINTF("2048 ok\n");
#endif
  //UCL_PRECOMP_R testing

  loop=10;
#ifdef VERBOSE
  PRINTF("DSA keygen+sign+verify (%d)\n",loop);
#endif
  //L=1024, N=160, SHA1
#ifdef VERBOSE
  PRINTF("MSG-SHA1-1024b\n");
#endif
  configuration=(UCL_MSG_INPUT<<UCL_INPUT_SHIFT)^(UCL_NO_PRECOMP<<UCL_PRECOMP_SHIFT)^(UCL_SHA1<<UCL_HASH_SHIFT);  
  for(i=0;i<loop;i++)
    {
      err=ucl_dsa_keygen(y,x,(u8*)p1024_nist,128,(u8*)q1024_nist,(u8*)g1024_nist);
      if(UCL_OK!=err)
	{
	  PRINTF("ERROR keygen %d\n",err);
	  return(UCL_ERROR);
	}
      memcpy(msg,msg1024_nist,3);
      msg_len=3;
      err=ucl_dsa_sign(r,s,(u8*)p1024_nist,128, (u8*)q1024_nist, (u8*)g1024_nist, x,msg, msg_len,configuration);
      if(UCL_OK!=err)
	{
	  PRINTF("ERROR (%d)during sign\n",err);
	  return(UCL_ERROR);
	}
      err=ucl_dsa_verify(r,s,(u8*)p1024_nist,128,(u8*)q1024_nist,(u8*)g1024_nist,y,msg,msg_len,configuration);
      if(UCL_OK!=err)
	{
	  PRINTF("ERROR (%d) during verify\n",err);
	  return(UCL_ERROR);
	}
    }
#ifdef VERBOSE
  PRINTF("HASH-SHA1-1024b\n");
#endif
  configuration=(UCL_HASH_INPUT<<UCL_INPUT_SHIFT)^(UCL_NO_PRECOMP<<UCL_PRECOMP_SHIFT)^(UCL_SHA1<<UCL_HASH_SHIFT);
  ucl_sha1(msg,msg1024_nist,3);
  msg_len=UCL_SHA1_HASHSIZE;
  for(i=0;i<loop;i++)
    {
      err=ucl_dsa_keygen(y,x,(u8*)p1024_nist,128,(u8*)q1024_nist,(u8*)g1024_nist);
      if(UCL_OK!=err)
	{
	  PRINTF("ERROR keygen %d\n",err);
	  return(UCL_ERROR);
	}
      err=ucl_dsa_sign(r,s,(u8*)p1024_nist,128, (u8*)q1024_nist, (u8*)g1024_nist, x,msg, msg_len,configuration);
      if(UCL_OK!=err)
	{
	  PRINTF("ERROR (%d)during sign\n",err);
	  return(UCL_ERROR);
	}
      err=ucl_dsa_verify(r,s,(u8*)p1024_nist,128,(u8*)q1024_nist,(u8*)g1024_nist,y,msg,msg_len,configuration);
      if(UCL_OK!=err)
	{
	  PRINTF("ERROR (%d) during verify\n",err);
	  return(UCL_ERROR);
	}
    }

#ifdef VERBOSE
  PRINTF("PRECOMP_R-SHA1-1024b\n");
#endif
  configuration=(UCL_NO_INPUT<<UCL_INPUT_SHIFT)^(UCL_PRECOMP_R<<UCL_PRECOMP_SHIFT)^(UCL_SHA1<<UCL_HASH_SHIFT);
  ucl_sha1(msg,msg1024_nist,3);
  msg_len=UCL_SHA1_HASHSIZE;
  for(i=0;i<loop;i++)
    {
      err=ucl_dsa_keygen(y,x,(u8*)p1024_nist,128,(u8*)q1024_nist,(u8*)g1024_nist);
      if(UCL_OK!=err)
	{
	  PRINTF("ERROR keygen %d\n",err);
	  return(UCL_ERROR);
	}
      err=ucl_dsa_sign(r_and_others,s,(u8*)p1024_nist,128, (u8*)q1024_nist, (u8*)g1024_nist, x,msg, msg_len,configuration);
      if(UCL_OK!=err)
	{
	  PRINTF("ERROR (%d)during sign\n",err);
	  return(UCL_ERROR);
	}
      configuration=(UCL_HASH_INPUT<<UCL_INPUT_SHIFT)^(UCL_R_PRECOMP<<UCL_PRECOMP_SHIFT)^(UCL_SHA1<<UCL_HASH_SHIFT);
      err=ucl_dsa_sign(r_and_others,s,(u8*)p1024_nist,128, (u8*)q1024_nist, (u8*)g1024_nist, x,msg, msg_len,configuration);
      if(UCL_OK!=err)
	{
	  PRINTF("ERROR (%d)during sign\n",err);
	  return(UCL_ERROR);
	}
      err=ucl_dsa_verify(r_and_others,s,(u8*)p1024_nist,128,(u8*)q1024_nist,(u8*)g1024_nist,y,msg,msg_len,configuration);
      if(UCL_OK!=err)
	{
	  PRINTF("ERROR (%d) during verify\n",err);
	  return(UCL_ERROR);
	}
    }

  loop=5;
  //L=2048, N=256, SHA256
#ifdef VERBOSE
  PRINTF("MSG-SHA256-2048b\n");
#endif
  configuration=(UCL_MSG_INPUT<<UCL_INPUT_SHIFT)^(UCL_NO_PRECOMP<<UCL_PRECOMP_SHIFT)^(UCL_SHA256<<UCL_HASH_SHIFT);  
  for(i=0;i<loop;i++)
    {
      err=ucl_dsa_keygen(y,x,(u8*)p2048_nist,256,(u8*)q2048_nist,(u8*)g2048_nist);
      if(UCL_OK!=err)
	{
	  PRINTF("ERROR keygen %d\n",err);
	  return(UCL_ERROR);
	}
      memcpy(msg,msg2048_nist,128);
      msg_len=128;
      err=ucl_dsa_sign(r,s,(u8*)p2048_nist,256, (u8*)q2048_nist, (u8*)g2048_nist, x,msg, msg_len,configuration);
      if(UCL_OK!=err)
	{
	  PRINTF("ERROR (%d)during sign\n",err);
	  return(UCL_ERROR);
	}
      err=ucl_dsa_verify(r,s,(u8*)p2048_nist,256,(u8*)q2048_nist,(u8*)g2048_nist,y,msg,msg_len,configuration);
      if(UCL_OK!=err)
	{
	  PRINTF("ERROR (%d) during verify\n",err);
	  return(UCL_ERROR);
	}
    }
#ifdef VERBOSE
  PRINTF("HASH-SHA256-2048b\n");
#endif
  configuration=(UCL_HASH_INPUT<<UCL_INPUT_SHIFT)^(UCL_NO_PRECOMP<<UCL_PRECOMP_SHIFT)^(UCL_SHA256<<UCL_HASH_SHIFT);
  ucl_sha256(msg,(u8*)msg2048_nist,128);
  msg_len=UCL_SHA256_HASHSIZE;
  for(i=0;i<loop;i++)
    {
      err=ucl_dsa_keygen(y,x,(u8*)p2048_nist,256,(u8*)q2048_nist,(u8*)g2048_nist);
      if(UCL_OK!=err)
	{
	  PRINTF("ERROR keygen %d\n",err);
	  return(UCL_ERROR);
	}
      err=ucl_dsa_sign(r,s,(u8*)p2048_nist,256, (u8*)q2048_nist, (u8*)g2048_nist, x,msg, msg_len,configuration);
      if(UCL_OK!=err)
	{
	  PRINTF("ERROR (%d)during sign\n",err);
	  return(UCL_ERROR);
	}
      err=ucl_dsa_verify(r,s,(u8*)p2048_nist,256,(u8*)q2048_nist,(u8*)g2048_nist,y,msg,msg_len,configuration);
      if(UCL_OK!=err)
	{
	  PRINTF("ERROR (%d) during verify\n",err);
	  return(UCL_ERROR);
	}
    }
#ifdef VERBOSE
  PRINTF("OK\n");
#endif
  return(UCL_OK);
}
#endif//DSA
